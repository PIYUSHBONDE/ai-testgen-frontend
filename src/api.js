import axios from "axios";

const API_BASE = "http://127.0.0.1:8000"; 



export async function runAgent(userId, sessionId, message) {
  // console.log(userId, sessionId, message);
  const res = await axios.post(`${API_BASE}/agent/run`, {
    user_id: userId,
    session_id: sessionId,
    message: message,
  });
  return res.data;
}

// export async function uploadFile(userId, sessionId, file) {
//   const formData = new FormData();
//   formData.append("file", file);
//   formData.append("user_id", userId);
//   formData.append("session_id", sessionId);

//   const res = await axios.post(`${API_BASE}/api/upload`, formData, {
//     headers: { "Content-Type": "multipart/form-data" },
//   });
//   return res.data;
// }

export async function exportTestCaseToJira(userId, projectKey, testCase, requirementKey = null) {
  const res = await axios.post(`${API_BASE}/api/jira/create-jira-test-case`, {
      user_id: userId,
      project_key: projectKey,
      test_case: testCase,
      requirement_key: requirementKey
  });
  return res.data;
}

export async function createNewSession(userId)
{
  const res = await axios.post(`${API_BASE}/new-session`,{
    user_id: userId
  });
  return res.data;
}

export async function fetchSessions(userId) {
  const res = await axios.get(`${API_BASE}/sessions/${userId}`);
  return res.data.sessions; // Expected: an array of session objects
}


export async function sendMessage(userId, sessionId, message) {
  const res = await axios.post(`${API_BASE}/sessions/${sessionId}/messages`, {
    user_id: userId,
    message: message,
  });
  return res.data; // Expected: { role: "assistant", text: "..." }

  // const dummyResponse = {
  //   role: "assistant",
  //   text: "markdown\nüéâ **Test Case Generation Successful!** üéâ\n\nA total of **260** individual test cases have been generated, organized into **13** test sets. These tests cover a variety of positive, negative, and boundary scenarios, with a focus on compliance.\n\nHere's a breakdown of the generated test sets:\n\n* **Set 1:** Account Registration Process: Positive, Negative, and Compliance Scenarios (20 test cases)\n* **Set 2:** User Registration and Account Creation: Positive, Negative, Boundary Tests (20 test cases)\n* **Set 3:** Registration process: Positive, negative, boundary and compliance tests (20 test cases)\n* **Set 4:** Registration and Onboarding Process: Positive, Negative, and Compliance Tests (20 test cases)\n* **Set 5:** User Registration and Onboarding Process: Positive, Negative, Compliance (20 test cases)\n* **Set 6:** User Registration & Compliance Test Cases (20 test cases)\n* **Set 7:** User Registration and Account Creation Test Cases (20 test cases)\n* **Set 8:** User Registration Process: Positive, Negative, Boundary & Compliance (20 test cases)\n* **Set 9:** User Registration and Account Creation Test Cases (20 test cases)\n* **Set 10:** User Registration and Account Creation Test Cases (20 test cases)\n* **Set 11:** User Registration and Account Creation Functionality Test Cases (20 test cases)\n* **Set 12:** User Registration & Account Creation: Positive & Negative Scenarios (20 test cases)\n* **Set 13:** Registration and Onboarding Process: Positive, Negative, Boundary, Compliance (20 test cases)\n\nThese test cases address compliance with the following rules: **HIPAA, FDA Guidelines (Data Integrity and Management), and ISO 27001 (Access Control, Cryptography & Data Security, Audit Logging & Traceability, Compliance & Privacy).**\n\nWe hope these comprehensive test cases help ensure the quality and compliance of your application! üëç\n",
  //   updated_title: "Mocked Conversation Title",
  //   aggregated_testcases: [{"testcases": [["1.", "*Positive Scenario: Verify \"Sign-Up\" button is present and clickable.", "The user is navigated to the registration method selection screen."], ["2.", "Positive Scenario: Verify successful registration using \"Sign up with Email\".", "The user receives an OTP verification email and is redirected to the OTP entry screen."], ["3.", "Positive Scenario: Verify password creation with minimum requirements.", "The password is accepted, and the user can proceed."], ["4.", "Positive Scenario: Verify entering a valid 6-digit OTP within 10 minutes.", "The user's email is successfully verified, and they are navigated to the basic profile setup screen."], ["5.", "Positive Scenario: Verify successful submission of basic profile information.", "The data is accepted, and the user is navigated to the consent and agreements screen."], ["6.", "Positive Scenario: Verify \"Finish\" button is disabled until consent is given.", "The button remains disabled. When the user checks the box, the button becomes active."], ["7.", "Positive Scenario: Verify the account is created and user is logged in.", "The user is shown the introductory onboarding tour."], ["8.", "Positive Scenario: Verify the user can skip the onboarding tour.", "The tour is dismissed, and the user is taken to the application's main dashboard."], ["9.", "Negative Scenario: Attempt to register with an already existing email.", "An error message \"This email address is already registered.\" is displayed."], ["10.", "Negative Scenario: Attempt to submit the form with a blank mandatory field.", "An inline error message \"This field is required.\" is displayed, and the form is not submitted."], ["11.", "Negative Scenario: Attempt to enter an invalid email format.", "A real-time validation error \"Please enter a valid email address.\" is displayed."], ["12.", "Negative Scenario: Attempt to create a password that does not meet security policy.", "An error message detailing all the required password criteria is displayed."], ["13.", "Negative Scenario: Attempt to enter non-matching passwords.", "An error message \"Passwords do not match.\" is displayed."], ["14.", "Negative Scenario: Enter an incorrect OTP.", "An error message \"Invalid OTP. Please try again.\" is displayed."], ["15.", "Negative Scenario: Enter a valid OTP after the 10-minute expiry window.", "An error message \"OTP has expired. Please request a new one.\" is displayed."], ["16.", "Boundary Case: Verify password creation with exactly 8 characters.", "The password is accepted successfully."], ["17.", "Compliance Adherence: Verify user consent is recorded with a timestamp.", "The database shows a record of the user's consent with the correct timestamp."], ["18.", "Compliance Adherence: Verify that the user's password is not stored in plain text.", "The user's record in the database contains a securely hashed and salted password."], ["19.", "Compliance Adherence: Verify all data transmitted during registration is encrypted.", "Network traffic analysis confirms that all communication is over a secure protocol."], ["20.", "Compliance Adherence: Verify a new user creation event is logged in the audit trail.", "The audit log contains an entry for the new user registration, including user ID, timestamp, and event type."]], "testcase_id": "7eee52f5-bde4-4230-bcab-240dc314ad7f", "Testcase Title": "Account Registration Process: Positive, Negative, and Compliance Scenarios", "compliance_ids": ["HIPAA", "ISO 27001 - Access Control", "ISO 27001 - Cryptography & Data Security", "ISO 27001 - Audit Logging & Traceability", "ISO 27001 - Compliance & Privacy", "FDA Guideline - Data Integrity and Management"]}, {"testcases": [["1.", "Positive Scenario: Verify the \"Sign-Up\" button is present and clickable on the main screen.", "The user is navigated to the registration method selection screen."], ["2.", "Positive Scenario: Verify successful registration using the \"Sign up with Email\" option with valid data.", "The user receives an OTP verification email and is redirected to the OTP entry screen."], ["3.", "Positive Scenario: Verify password creation with minimum requirements (8 characters, 1 uppercase, 1 lowercase, 1 number, 1 special character).", "The password is accepted, and the user can proceed."], ["4.", "Positive Scenario: Verify entering a valid 6-digit OTP within the 10-minute expiry window.", "The user's email is successfully verified, and they are navigated to the basic profile setup screen."], ["5.", "Positive Scenario: Verify successful submission of basic profile information (DOB, Phone Number).", "The data is accepted, and the user is navigated to the consent and agreements screen."], ["6.", "Positive Scenario: Verify the \"Finish\" button is disabled until the consent checkbox is ticked.", "The button remains disabled. When the user checks the box, the button becomes active."], ["7.", "Positive Scenario: Verify the account is created and the user is logged in after giving consent.", "The user is shown the introductory onboarding tour."], ["8.", "Positive Scenario: Verify the user can skip the onboarding tour.", "The tour is dismissed, and the user is taken to the application's main dashboard."], ["9.", "Negative Scenario: Attempt to register with an already existing email address.", "An error message \"This email address is already registered.\" is displayed."], ["10.", "Negative Scenario: Attempt to submit the registration form with a blank mandatory field (e.g., First Name).", "An inline error message \"This field is required.\" is displayed, and the form is not submitted."], ["11.", "Negative Scenario: Attempt to enter an invalid email format (e.g., \"test@test\").", "A real-time validation error \"Please enter a valid email address.\" is displayed."], ["12.", "Negative Scenario: Attempt to create a password that does not meet the security policy (e.g., less than 8 characters).", "An error message detailing all the required password criteria is displayed."], ["13.", "Negative Scenario: Attempt to enter non-matching passwords in the \"Password\" and \"Confirm Password\" fields.", "An error message \"Passwords do not match.\" is displayed."], ["14.", "Negative Scenario: Enter an incorrect OTP.", "An error message \"Invalid OTP. Please try again.\" is displayed."], ["15.", "Negative Scenario: Enter a valid OTP after the 10-minute expiry window.", "An error message \"OTP has expired. Please request a new one.\" is displayed."], ["16.", "Boundary Case: Verify password creation with exactly 8 characters that meet all other criteria.", "The password is accepted successfully."], ["17.", "Compliance Adherence: Verify that user consent for ToS, Privacy Policy, and HIPAA Notice is recorded with a timestamp in the database.", "The database shows a record of the user's consent with the correct timestamp upon account creation."], ["18.", "Compliance Adherence: Verify that the user's password is not stored in plain text in the database.", "The user's record in the database contains a securely hashed and salted password."], ["19.", "Compliance Adherence: Verify that all data transmitted during the registration process is encrypted.", "Network traffic analysis confirms that all communication between the app and server is over a secure protocol (e.g., TLS 1.2+)."], ["20.", "Compliance Adherence: Verify that a new user creation event is logged in the system's audit trail.", "The audit log contains an entry for the new user registration, including user ID, timestamp, and event type."]], "testcase_id": "1d447bc0-d585-4c07-babe-0ddc0948b395", "Testcase Title": "User Registration and Account Creation: Positive, Negative, Boundary Tests", "compliance_ids": ["HIPAA", "ISO 27001"]}, {"testcases": [["1.", "Positive Scenario: Verify the \"Sign-Up\" button is present and clickable on the main screen.", "The user is navigated to the registration method selection screen."], ["2.", "Positive Scenario: Verify successful registration using the \"Sign up with Email\" option with valid data.", "The user receives an OTP verification email and is redirected to the OTP entry screen."], ["3.", "Positive Scenario: Verify password creation with minimum requirements (8 characters, 1 uppercase, 1 lowercase, 1 number, 1 special character).", "The password is accepted, and the user can proceed."], ["4.", "Positive Scenario: Verify entering a valid 6-digit OTP within the 10-minute expiry window.", "The user's email is successfully verified, and they are navigated to the basic profile setup screen."], ["5.", "Positive Scenario: Verify successful submission of basic profile information (DOB, Phone Number).", "The data is accepted, and the user is navigated to the consent and agreements screen."], ["6.", "Positive Scenario: Verify the \"Finish\" button is disabled until the consent checkbox is ticked.", "The button remains disabled. When the user checks the box, the button becomes active."], ["7.", "Positive Scenario: Verify the account is created and the user is logged in after giving consent.", "The user is shown the introductory onboarding tour."], ["8.", "Positive Scenario: Verify the user can skip the onboarding tour.", "The tour is dismissed, and the user is taken to the application's main dashboard."], ["9.", "Negative Scenario: Attempt to register with an already existing email address.", "An error message \"This email address is already registered.\" is displayed."], ["10.", "Negative Scenario: Attempt to submit the registration form with a blank mandatory field (e.g., First Name).", "An inline error message \"This field is required.\" is displayed, and the form is not submitted."], ["11.", "Negative Scenario: Attempt to enter an invalid email format (e.g., \"test@test\").", "A real-time validation error \"Please enter a valid email address.\" is displayed."], ["12.", "Negative Scenario: Attempt to create a password that does not meet the security policy (e.g., less than 8 characters).", "An error message detailing all the required password criteria is displayed."], ["13.", "Negative Scenario: Attempt to enter non-matching passwords in the \"Password\" and \"Confirm Password\" fields.", "An error message \"Passwords do not match.\" is displayed."], ["14.", "Negative Scenario: Enter an incorrect OTP.", "An error message \"Invalid OTP. Please try again.\" is displayed."], ["15.", "Negative Scenario: Enter a valid OTP after the 10-minute expiry window.", "An error message \"OTP has expired. Please request a new one.\" is displayed."], ["16.", "Boundary Case: Verify password creation with exactly 8 characters that meet all other criteria.", "The password is accepted successfully."], ["17.", "Compliance Adherence: Verify that user consent for ToS, Privacy Policy, and HIPAA Notice is recorded with a timestamp in the database.", "The database shows a record of the user's consent with the correct timestamp upon account creation."], ["18.", "Compliance Adherence: Verify that the user's password is not stored in plain text in the database.", "The user's record in the database contains a securely hashed and salted password."], ["19.", "Compliance Adherence: Verify that all data transmitted during the registration process is encrypted.", "Network traffic analysis confirms that all communication between the app and server is over a secure protocol (e.g., TLS 1.2+)."], ["20.", "Compliance Adherence: Verify that a new user creation event is logged in the system's audit trail.", "The audit log contains an entry for the new user registration, including user ID, timestamp, and event type."]], "testcase_id": "55b8502e-9e74-405b-a617-c95b96604fc5", "Testcase Title": "Registration process: Positive, negative, boundary and compliance tests", "compliance_ids": ["HIPAA", "ISO 27001", "FDA Guideline"]}, {"testcases": [["1.", "Positive Scenario: Verify \"Sign-Up\" button is present and clickable.", "User is navigated to registration method selection screen."], ["2.", "Positive Scenario: Verify successful registration using \"Sign up with Email\".", "User receives OTP verification email and is redirected to OTP entry screen."], ["3.", "Positive Scenario: Verify password creation with minimum requirements.", "Password is accepted, and the user can proceed."], ["4.", "Positive Scenario: Verify entering a valid 6-digit OTP within 10 minutes.", "User's email is verified, and they are navigated to basic profile setup screen."], ["5.", "Positive Scenario: Verify successful submission of basic profile information.", "Data is accepted, and the user is navigated to the consent and agreements screen."], ["6.", "Positive Scenario: Verify \"Finish\" button is disabled until consent is given.", "Button remains disabled; becomes active when the user checks the box."], ["7.", "Positive Scenario: Verify account creation and login after consent.", "User is shown the introductory onboarding tour."], ["8.", "Positive Scenario: Verify the user can skip the onboarding tour.", "Tour is dismissed, and the user is taken to the application's main dashboard."], ["9.", "Negative Scenario: Attempt registration with an existing email address.", "Error message \"This email address is already registered.\" is displayed."], ["10.", "Negative Scenario: Attempt to submit with a blank mandatory field.", "Inline error message \"This field is required.\" is displayed."], ["11.", "Negative Scenario: Attempt to enter an invalid email format.", "Real-time validation error \"Please enter a valid email address.\" is displayed."], ["12.", "Negative Scenario: Attempt to create an invalid password.", "Error message detailing all the required password criteria is displayed."], ["13.", "Negative Scenario: Attempt to enter non-matching passwords.", "Error message \"Passwords do not match.\" is displayed."], ["14.", "Negative Scenario: Enter an incorrect OTP.", "Error message \"Invalid OTP. Please try again.\" is displayed."], ["15.", "Negative Scenario: Enter a valid OTP after expiry.", "Error message \"OTP has expired. Please request a new one.\" is displayed."], ["16.", "Boundary Case: Verify password creation with exactly 8 characters.", "The password is accepted successfully."], ["17.", "Compliance Adherence: Verify consent recorded with timestamp in database.", "Database shows user's consent with the correct timestamp."], ["18.", "Compliance Adherence: Verify password is not stored in plain text.", "User's record contains a securely hashed and salted password."], ["19.", "Compliance Adherence: Verify all data is encrypted during registration.", "Network analysis confirms secure protocol (e.g., TLS 1.2+)."], ["20.", "Compliance Adherence: Verify a new user creation event is logged.", "Audit log contains entry for registration, including ID, timestamp, event."]], "testcase_id": "b299e13f-90f8-4603-ad0d-27e7e6ea2ddf", "Testcase Title": "Registration and Onboarding Process: Positive, Negative, and Compliance Tests", "compliance_ids": ["HIPAA", "ISO 27001 - Access Control", "ISO 27001 - Cryptography & Data Security", "ISO 27001 - Audit Logging & Traceability", "ISO 27001 - Compliance & Privacy", "FDA Guideline - Data Integrity and Management"]}, {"testcases": [["1.", "Positive Scenario: Verify the \"Sign-Up\" button is present and clickable on the main screen.", "The user is navigated to the registration method selection screen."], ["2.", "Positive Scenario: Verify successful registration using the \"Sign up with Email\" option with valid data.", "The user receives an OTP verification email and is redirected to the OTP entry screen."], ["3.", "Positive Scenario: Verify password creation with minimum requirements (8 characters, 1 uppercase, 1 lowercase, 1 number, 1 special character).", "The password is accepted, and the user can proceed."], ["4.", "Positive Scenario: Verify entering a valid 6-digit OTP within the 10-minute expiry window.", "The user's email is successfully verified, and they are navigated to the basic profile setup screen."], ["5.", "Positive Scenario: Verify successful submission of basic profile information (DOB, Phone Number).", "The data is accepted, and the user is navigated to the consent and agreements screen."], ["6.", "Positive Scenario: Verify the \"Finish\" button is disabled until the consent checkbox is ticked.", "The button remains disabled. When the user checks the box, the button becomes active."], ["7.", "Positive Scenario: Verify the account is created and the user is logged in after giving consent.", "The user is shown the introductory onboarding tour."], ["8.", "Positive Scenario: Verify the user can skip the onboarding tour.", "The tour is dismissed, and the user is taken to the application's main dashboard."], ["9.", "Negative Scenario: Attempt to register with an already existing email address.", "An error message \"This email address is already registered.\" is displayed."], ["10.", "Negative Scenario: Attempt to submit the registration form with a blank mandatory field (e.g., First Name).", "An inline error message \"This field is required.\" is displayed, and the form is not submitted."], ["11.", "Negative Scenario: Attempt to enter an invalid email format (e.g., \"test@test\").", "A real-time validation error \"Please enter a valid email address.\" is displayed."], ["12.", "Negative Scenario: Attempt to create a password that does not meet the security policy (e.g., less than 8 characters).", "An error message detailing all the required password criteria is displayed."], ["13.", "Negative Scenario: Attempt to enter non-matching passwords in the \"Password\" and \"Confirm Password\" fields.", "An error message \"Passwords do not match.\" is displayed."], ["14.", "Negative Scenario: Enter an incorrect OTP.", "An error message \"Invalid OTP. Please try again.\" is displayed."], ["15.", "Negative Scenario: Enter a valid OTP after the 10-minute expiry window.", "An error message \"OTP has expired. Please request a new one.\" is displayed."], ["16.", "Boundary Case: Verify password creation with exactly 8 characters that meet all other criteria.", "The password is accepted successfully."], ["17.", "Compliance Adherence: Verify that user consent for ToS, Privacy Policy, and HIPAA Notice is recorded with a timestamp in the database.", "The database shows a record of the user's consent with the correct timestamp upon account creation."], ["18.", "Compliance Adherence: Verify that the user's password is not stored in plain text in the database.", "The user's record in the database contains a securely hashed and salted password."], ["19.", "Compliance Adherence: Verify that all data transmitted during the registration process is encrypted.", "Network traffic analysis confirms that all communication between the app and server is over a secure protocol (e.g., TLS 1.2+)."], ["20.", "Compliance Adherence: Verify that a new user creation event is logged in the system's audit trail.", "The audit log contains an entry for the new user registration, including user ID, timestamp, and event type."]], "testcase_id": "e6aeab56-8b00-4381-aa93-383eceefa09f", "Testcase Title": "User Registration and Onboarding Process: Positive, Negative, Compliance", "compliance_ids": ["HIPAA (Health Insurance Portability and Accountability Act)", "ISO 27001 - Access Control", "ISO 27001 - Cryptography & Data Security", "ISO 27001 - Audit Logging & Traceability", "ISO 27001 - Compliance & Privacy", "FDA Guideline - Data Integrity and Management"]}, {"testcases": [["1.", "Verify \"Sign-Up\" button presence and clickability.", "User is navigated to registration method selection screen."], ["2.", "Verify successful registration with valid email data.", "User receives OTP email and is redirected to OTP screen."], ["3.", "Verify password creation with minimum requirements.", "The password is accepted, and the user can proceed."], ["4.", "Verify entering a valid 6-digit OTP within the expiry window.", "User's email is verified, and they are navigated to profile setup screen."], ["5.", "Verify successful submission of basic profile information.", "The data is accepted, and the user is navigated to the consent screen."], ["6.", "Verify the \"Finish\" button is disabled until consent is given.", "The button remains disabled. When the user checks the box, the button becomes active."], ["7.", "Verify account creation and user login after consent.", "The user is shown the introductory onboarding tour."], ["8.", "Verify the user can skip the onboarding tour.", "The tour is dismissed, and the user is taken to the application's main dashboard."], ["9.", "Attempt registration with an existing email.", "Error: \"This email address is already registered.\""], ["10.", "Attempt registration with a blank mandatory field.", "Inline error: \"This field is required.\""], ["11.", "Attempt to enter an invalid email format.", "Real-time validation error: \"Please enter a valid email address.\""], ["12.", "Attempt to create a password that doesn't meet security policy.", "Error detailing required password criteria is displayed."], ["13.", "Attempt to enter non-matching passwords.", "Error: \"Passwords do not match.\""], ["14.", "Enter an incorrect OTP.", "Error: \"Invalid OTP. Please try again.\""], ["15.", "Enter a valid OTP after the expiry window.", "Error: \"OTP has expired. Please request a new one.\""], ["16.", "Verify password creation with exactly 8 characters.", "The password is accepted successfully."], ["17.", "Verify consent for ToS, Privacy Policy, and HIPAA is recorded.", "Database shows John Doe's consent with timestamp."], ["18.", "Verify the user's password is not stored in plain text.", "Database contains a securely hashed and salted password."], ["19.", "Verify that all registration data is encrypted.", "Network traffic confirms TLS 1.2+ encryption."], ["20.", "Verify a new user creation event is logged.", "Audit log contains an entry for the user registration."]], "testcase_id": "07c3be6d-0cc5-438e-bee8-278f6cd4be42", "Testcase Title": "User Registration & Compliance Test Cases", "compliance_ids": ["HIPAA", "ISO 27001"]}, {"testcases": [["1.", "Positive Scenario: Verify \"Sign-Up\" button is present and clickable.", "The user is navigated to the registration method selection screen."], ["2.", "Positive Scenario: Verify successful registration with valid email.", "The user receives an OTP and is redirected to the OTP entry screen."], ["3.", "Positive Scenario: Verify password creation with minimum requirements.", "The password is accepted, and the user can proceed."], ["4.", "Positive Scenario: Verify entering a valid 6-digit OTP within expiry.", "The user's email is verified, and they are navigated to profile setup."], ["5.", "Positive Scenario: Verify successful submission of basic profile information.", "The data is accepted, and the user is navigated to consent screen."], ["6.", "Positive Scenario: Verify \"Finish\" button disabled until consent ticked.", "The button remains disabled until the user checks the box."], ["7.", "Positive Scenario: Verify account created and user logged in after consent.", "The user is shown the introductory onboarding tour."], ["8.", "Positive Scenario: Verify user can skip onboarding tour with \"Skip\".", "The tour is dismissed, and the user is taken to the main dashboard."], ["9.", "Negative Scenario: Attempt to register with an existing email.", "An error message \"This email address is already registered.\" is displayed."], ["10.", "Negative Scenario: Submit registration form with a blank field.", "An inline error message \"This field is required.\" is displayed."], ["11.", "Negative Scenario: Attempt to enter an invalid email format.", "A real-time validation error \"Please enter a valid email address.\" is displayed."], ["12.", "Negative Scenario: Attempt password that doesn't meet security policy.", "An error message detailing all password criteria is displayed."], ["13.", "Negative Scenario: Enter non-matching passwords in Password fields.", "An error message \"Passwords do not match.\" is displayed."], ["14.", "Negative Scenario: Enter an incorrect OTP.", "An error message \"Invalid OTP. Please try again.\" is displayed."], ["15.", "Negative Scenario: Enter a valid OTP after the expiry window.", "An error message \"OTP has expired. Please request a new one.\" is displayed."], ["16.", "Boundary Case: Verify password creation with 8 characters.", "The password is accepted successfully."], ["17.", "Compliance Adherence: Verify consent for ToS, Privacy Policy is recorded.", "The database shows a record of consent with the correct timestamp."], ["18.", "Compliance Adherence: Verify user's password is not stored in plain text.", "The user's record contains a securely hashed and salted representation of the password."], ["19.", "Compliance Adherence: Verify all data transmitted is encrypted.", "Network analysis confirms communication is over a secure protocol."], ["20.", "Compliance Adherence: Verify a new user creation event is logged.", "The audit log contains an entry for the new user registration."]], "testcase_id": "1e01dfdc-3f07-4faa-9256-9cfea710e4a6", "Testcase Title": "User Registration and Account Creation Test Cases", "compliance_ids": ["HIPAA", "ISO 27001 - Access Control", "ISO 27001 - Cryptography & Data Security", "ISO 27001 - Audit Logging & Traceability", "ISO 27001 - Compliance & Privacy", "FDA Guideline - Data Integrity and Management"]}, {"testcases": [["1.", "Positive Scenario: Verify \"Sign-Up\" button presence and clickability.", "The user is navigated to the registration method selection screen."], ["2.", "Positive Scenario: Verify successful registration using \"Sign up with Email\".", "The user receives an OTP verification email and is redirected to the OTP entry screen."], ["3.", "Positive Scenario: Verify password creation with minimum requirements.", "The password is accepted, and the user can proceed."], ["4.", "Positive Scenario: Verify valid 6-digit OTP entry within 10-minute window.", "The user's email is successfully verified, and they are navigated to the basic profile setup screen."], ["5.", "Positive Scenario: Verify successful submission of basic profile information.", "The data is accepted, and the user is navigated to the consent and agreements screen."], ["6.", "Positive Scenario: Verify \"Finish\" button is disabled until consent is given.", "The button remains disabled. When the user checks the box, the button becomes active."], ["7.", "Positive Scenario: Verify account creation and user login after consent.", "The user is shown the introductory onboarding tour."], ["8.", "Positive Scenario: Verify the user can skip the onboarding tour.", "The tour is dismissed, and the user is taken to the application's main dashboard."], ["9.", "Negative Scenario: Attempt registration with an existing email address.", "An error message \"This email address is already registered.\" is displayed."], ["10.", "Negative Scenario: Attempt to submit the form with a blank mandatory field.", "An inline error message \"This field is required.\" is displayed, and the form is not submitted."], ["11.", "Negative Scenario: Attempt to enter an invalid email format.", "A real-time validation error \"Please enter a valid email address.\" is displayed."], ["12.", "Negative Scenario: Attempt to create a password that does not meet the security policy.", "An error message detailing all the required password criteria is displayed."], ["13.", "Negative Scenario: Attempt to enter non-matching passwords.", "An error message \"Passwords do not match.\" is displayed."], ["14.", "Negative Scenario: Enter an incorrect OTP.", "An error message \"Invalid OTP. Please try again.\" is displayed."], ["15.", "Negative Scenario: Enter a valid OTP after the 10-minute expiry window.", "An error message \"OTP has expired. Please request a new one.\" is displayed."], ["16.", "Boundary Case: Verify password creation with exactly 8 characters.", "The password is accepted successfully."], ["17.", "Compliance Adherence: Verify user consent is recorded with a timestamp.", "The database shows a record of the user's consent with the correct timestamp upon account creation."], ["18.", "Compliance Adherence: Verify the user's password is not stored in plain text.", "The user's record in the database contains a securely hashed and salted password."], ["19.", "Compliance Adherence: Verify that all data transmitted during registration is encrypted.", "Network traffic analysis confirms that all communication between the app and server is over a secure protocol (e.g., TLS 1.2+)."], ["20.", "Compliance Adherence: Verify a new user creation event is logged in the system's audit trail.", "The audit log contains an entry for the new user registration, including user ID, timestamp, and event type."]], "testcase_id": "2f4d264c-acf9-4a99-9fd1-0b8905cdd609", "Testcase Title": "User Registration Process: Positive, Negative, Boundary & Compliance", "compliance_ids": ["HIPAA", "ISO 27001"]}, {"testcases": [["1.", "Positive Scenario: Verify the \"Sign-Up\" button is present and clickable on the main screen.", "The user is navigated to the registration method selection screen."], ["2.", "Positive Scenario: Verify successful registration using the \"Sign up with Email\" option with valid data.", "The user receives an OTP verification email and is redirected to the OTP entry screen."], ["3.", "Positive Scenario: Verify password creation with minimum requirements (8 characters, 1 uppercase, 1 lowercase, 1 number, 1 special character).", "The password is accepted, and the user can proceed."], ["4.", "Positive Scenario: Verify entering a valid 6-digit OTP within the 10-minute expiry window.", "The user's email is successfully verified, and they are navigated to the basic profile setup screen."], ["5.", "Positive Scenario: Verify successful submission of basic profile information (DOB, Phone Number).", "The data is accepted, and the user is navigated to the consent and agreements screen."], ["6.", "Positive Scenario: Verify the \"Finish\" button is disabled until the consent checkbox is ticked.", "The button remains disabled. When the user checks the box, the button becomes active."], ["7.", "Positive Scenario: Verify the account is created and the user is logged in after giving consent.", "The user is shown the introductory onboarding tour."], ["8.", "Positive Scenario: Verify the user can skip the onboarding tour.", "The tour is dismissed, and the user is taken to the application's main dashboard."], ["9.", "Negative Scenario: Attempt to register with an already existing email address.", "An error message \"This email address is already registered.\" is displayed."], ["10.", "Negative Scenario: Attempt to submit the registration form with a blank mandatory field (e.g., First Name).", "An inline error message \"This field is required.\" is displayed, and the form is not submitted."], ["11.", "Negative Scenario: Attempt to enter an invalid email format (e.g., \"test@test\").", "A real-time validation error \"Please enter a valid email address.\" is displayed."], ["12.", "Negative Scenario: Attempt to create a password that does not meet the security policy (e.g., less than 8 characters).", "An error message detailing all the required password criteria is displayed."], ["13.", "Negative Scenario: Attempt to enter non-matching passwords in the \"Password\" and \"Confirm Password\" fields.", "An error message \"Passwords do not match.\" is displayed."], ["14.", "Negative Scenario: Enter an incorrect OTP.", "An error message \"Invalid OTP. Please try again.\" is displayed."], ["15.", "Negative Scenario: Enter a valid OTP after the 10-minute expiry window.", "An error message \"OTP has expired. Please request a new one.\" is displayed."], ["16.", "Boundary Case: Verify password creation with exactly 8 characters that meet all other criteria.", "The password is accepted successfully."], ["17.", "Compliance Adherence: Verify that user consent for ToS, Privacy Policy, and HIPAA Notice is recorded with a timestamp in the database.", "The database shows a record of the user's consent with the correct timestamp upon account creation."], ["18.", "Compliance Adherence: Verify that the user's password is not stored in plain text in the database.", "The user's record in the database contains a securely hashed and salted password."], ["19.", "Compliance Adherence: Verify that all data transmitted during the registration process is encrypted.", "Network traffic analysis confirms that all communication between the app and server is over a secure protocol (e.g., TLS 1.2+)."], ["20.", "Compliance Adherence: Verify that a new user creation event is logged in the system's audit trail.", "The audit log contains an entry for the new user registration, including user ID, timestamp, and event type."]], "testcase_id": "5075a043-c36f-491b-b429-34806e98f25a", "Testcase Title": "User Registration and Account Creation Test Cases", "compliance_ids": ["HIPAA", "ISO 27001 - Access Control", "ISO 27001 - Cryptography & Data Security", "ISO 27001 - Audit Logging & Traceability", "ISO 27001 - Compliance & Privacy", "FDA Guideline - Data Integrity and Management"]}, {"testcases": [["1.", "Positive Scenario: Verify 'Sign-Up' button presence and click.", "The user is navigated to the registration method selection screen."], ["2.", "Positive Scenario: Verify successful registration using 'Sign up with Email'.", "The user receives an OTP verification email and is redirected to the OTP entry screen."], ["3.", "Positive Scenario: Verify password creation with minimum requirements.", "The password is accepted, and the user can proceed."], ["4.", "Positive Scenario: Verify entering a valid 6-digit OTP within the window.", "The user's email is successfully verified, and they are navigated to the basic profile setup screen."], ["5.", "Positive Scenario: Verify successful submission of basic profile information.", "The data is accepted, and the user is navigated to the consent and agreements screen."], ["6.", "Positive Scenario: Verify 'Finish' button disabled until consent is ticked.", "The button remains disabled. When the user checks the box, the button becomes active."], ["7.", "Positive Scenario: Verify account creation and login after consent.", "The user is shown the introductory onboarding tour."], ["8.", "Positive Scenario: Verify the user can skip the onboarding tour.", "The tour is dismissed, and the user is taken to the application's main dashboard."], ["9.", "Negative Scenario: Attempt to register with an existing email.", "An error message \"This email address is already registered.\" is displayed."], ["10.", "Negative Scenario: Attempt to submit form with a blank mandatory field.", "An inline error message \"This field is required.\" is displayed, and the form is not submitted."], ["11.", "Negative Scenario: Attempt to enter an invalid email format.", "A real-time validation error \"Please enter a valid email address.\" is displayed."], ["12.", "Negative Scenario: Attempt to create a password that doesn't meet criteria.", "An error message detailing all the required password criteria is displayed."], ["13.", "Negative Scenario: Attempt to enter non-matching passwords.", "An error message \"Passwords do not match.\" is displayed."], ["14.", "Negative Scenario: Enter an incorrect OTP.", "An error message \"Invalid OTP. Please try again.\" is displayed."], ["15.", "Negative Scenario: Enter a valid OTP after the expiry window.", "An error message \"OTP has expired. Please request a new one.\" is displayed."], ["16.", "Boundary Case: Verify password creation with exactly 8 characters.", "The password is accepted successfully."], ["17.", "Compliance Adherence: Verify user consent recorded with timestamp.", "The database shows a record of the user's consent with the correct timestamp upon account creation."], ["18.", "Compliance Adherence: Verify user's password is not stored in plain text.", "The user's record in the database contains a securely hashed and salted password."], ["19.", "Compliance Adherence: Verify all data transmitted during registration is encrypted.", "Network traffic analysis confirms that all communication between the app and server is over a secure protocol (e.g., TLS 1.2+)."], ["20.", "Compliance Adherence: Verify a new user creation event is logged.", "The audit log contains an entry for the new user registration, including user ID, timestamp, and event type."]], "testcase_id": "86338621-1da9-4cca-ba75-497f149946fe", "Testcase Title": "User Registration and Account Creation Test Cases", "compliance_ids": ["HIPAA", "ISO 27001 - Access Control", "ISO 27001 - Cryptography & Data Security", "ISO 27001 - Audit Logging & Traceability", "ISO 27001 - Compliance & Privacy", "FDA Guideline - Data Integrity and Management"]}, {"testcases": [["1.", "Positive Scenario: Verify the \"Sign-Up\" button is present and clickable on the main screen.", "The user is navigated to the registration method selection screen."], ["2.", "Positive Scenario: Verify successful registration using the \"Sign up with Email\" option with valid data.", "The user receives an OTP verification email and is redirected to the OTP entry screen."], ["3.", "Positive Scenario: Verify password creation with minimum requirements (8 characters, 1 uppercase, 1 lowercase, 1 number, 1 special character).", "The password is accepted, and the user can proceed."], ["4.", "Positive Scenario: Verify entering a valid 6-digit OTP within the 10-minute expiry window.", "The user's email is successfully verified, and they are navigated to the basic profile setup screen."], ["5.", "Positive Scenario: Verify successful submission of basic profile information (DOB, Phone Number).", "The data is accepted, and the user is navigated to the consent and agreements screen."], ["6.", "Positive Scenario: Verify the \"Finish\" button is disabled until the consent checkbox is ticked.", "The button remains disabled. When the user checks the box, the button becomes active."], ["7.", "Positive Scenario: Verify the account is created and the user is logged in after giving consent.", "The user is shown the introductory onboarding tour."], ["8.", "Positive Scenario: Verify the user can skip the onboarding tour.", "The tour is dismissed, and the user is taken to the application's main dashboard."], ["9.", "Negative Scenario: Attempt to register with an already existing email address.", "An error message \"This email address is already registered.\" is displayed."], ["10.", "Negative Scenario: Attempt to submit the registration form with a blank mandatory field (e.g., First Name).", "An inline error message \"This field is required.\" is displayed, and the form is not submitted."], ["11.", "Negative Scenario: Attempt to enter an invalid email format (e.g., \"test@test\").", "A real-time validation error \"Please enter a valid email address.\" is displayed."], ["12.", "Negative Scenario: Attempt to create a password that does not meet the security policy (e.g., less than 8 characters).", "An error message detailing all the required password criteria is displayed."], ["13.", "Negative Scenario: Attempt to enter non-matching passwords in the \"Password\" and \"Confirm Password\" fields.", "An error message \"Passwords do not match.\" is displayed."], ["14.", "Negative Scenario: Enter an incorrect OTP.", "An error message \"Invalid OTP. Please try again.\" is displayed."], ["15.", "Negative Scenario: Enter a valid OTP after the 10-minute expiry window.", "An error message \"OTP has expired. Please request a new one.\" is displayed."], ["16.", "Boundary Case: Verify password creation with exactly 8 characters that meet all other criteria.", "The password is accepted successfully."], ["17.", "Compliance Adherence: Verify that user consent for ToS, Privacy Policy, and HIPAA Notice is recorded with a timestamp in the database.", "The database shows a record of the user's consent with the correct timestamp upon account creation."], ["18.", "Compliance Adherence: Verify that the user's password is not stored in plain text in the database.", "The user's record in the database contains a securely hashed and salted password."], ["19.", "Compliance Adherence: Verify that all data transmitted during the registration process is encrypted.", "Network traffic analysis confirms that all communication between the app and server is over a secure protocol (e.g., TLS 1.2+)."], ["20.", "Compliance Adherence: Verify that a new user creation event is logged in the system's audit trail.", "The audit log contains an entry for the new user registration, including user ID, timestamp, and event type."]], "testcase_id": "be65a286-f6cf-45f2-923e-a4d719dfe0e5", "Testcase Title": "User Registration and Account Creation Functionality Test Cases", "compliance_ids": ["HIPAA (Health Insurance Portability and Accountability Act)", "ISO 27001 - Access Control", "ISO 27001 - Cryptography & Data Security", "ISO 27001 - Audit Logging & Traceability", "ISO 27001 - Compliance & Privacy", "FDA Guideline - Data Integrity and Management"]}, {"testcases": [["1.", "Positive Scenario: Verify the \"Sign-Up\" button is present and clickable on the main screen.", "The user is navigated to the registration method selection screen."], ["2.", "Positive Scenario: Verify successful registration using the \"Sign up with Email\" option with valid data.", "The user receives an OTP verification email and is redirected to the OTP entry screen."], ["3.", "Positive Scenario: Verify password creation with minimum requirements (8 characters, 1 uppercase, 1 lowercase, 1 number, 1 special character).", "The password is accepted, and the user can proceed."], ["4.", "Positive Scenario: Verify entering a valid 6-digit OTP within the 10-minute expiry window.", "The user's email is successfully verified, and they are navigated to the basic profile setup screen."], ["5.", "Positive Scenario: Verify successful submission of basic profile information (DOB, Phone Number).", "The data is accepted, and the user is navigated to the consent and agreements screen."], ["6.", "Positive Scenario: Verify the \"Finish\" button is disabled until the consent checkbox is ticked.", "The button remains disabled. When the user checks the box, the button becomes active."], ["7.", "Positive Scenario: Verify the account is created and the user is logged in after giving consent.", "The user is shown the introductory onboarding tour."], ["8.", "Positive Scenario: Verify the user can skip the onboarding tour.", "The tour is dismissed, and the user is taken to the application's main dashboard."], ["9.", "Negative Scenario: Attempt to register with an already existing email address.", "An error message \"This email address is already registered.\" is displayed."], ["10.", "Negative Scenario: Attempt to submit the registration form with a blank mandatory field (e.g., First Name).", "An inline error message \"This field is required.\" is displayed, and the form is not submitted."], ["11.", "Negative Scenario: Attempt to enter an invalid email format (e.g., \"test@test\").", "A real-time validation error \"Please enter a valid email address.\" is displayed."], ["12.", "Negative Scenario: Attempt to create a password that does not meet the security policy (e.g., less than 8 characters).", "An error message detailing all the required password criteria is displayed."], ["13.", "Negative Scenario: Attempt to enter non-matching passwords in the \"Password\" and \"Confirm Password\" fields.", "An error message \"Passwords do not match.\" is displayed."], ["14.", "Negative Scenario: Enter an incorrect OTP.", "An error message \"Invalid OTP. Please try again.\" is displayed."], ["15.", "Negative Scenario: Enter a valid OTP after the 10-minute expiry window.", "An error message \"OTP has expired. Please request a new one.\" is displayed."], ["16.", "Boundary Case: Verify password creation with exactly 8 characters that meet all other criteria.", "The password is accepted successfully."], ["17.", "Compliance Adherence: Verify that user consent for ToS, Privacy Policy, and HIPAA Notice is recorded with a timestamp in the database.", "The database shows a record of the user's consent with the correct timestamp upon account creation."], ["18.", "Compliance Adherence: Verify that the user's password is not stored in plain text in the database.", "The user's record in the database contains a securely hashed and salted password."], ["19.", "Compliance Adherence: Verify that all data transmitted during the registration process is encrypted.", "Network traffic analysis confirms that all communication between the app and server is over a secure protocol (e.g., TLS 1.2+)."], ["20.", "Compliance Adherence: Verify that a new user creation event is logged in the system's audit trail.", "The audit log contains an entry for the new user registration, including user ID, timestamp, and event type."]], "testcase_id": "50f9402e-266d-4437-8a5b-3b895646d44f", "Testcase Title": "User Registration & Account Creation: Positive & Negative Scenarios", "compliance_ids": ["HIPAA", "ISO 27001", "FDA Guideline"]}, {"testcases": [["1.", "Positive Scenario: Verify the \"Sign-Up\" button is present and clickable on the main screen.", "The user is navigated to the registration method selection screen."], ["2.", "Positive Scenario: Verify successful registration using the \"Sign up with Email\" option with valid data.", "The user receives an OTP verification email and is redirected to the OTP entry screen."], ["3.", "Positive Scenario: Verify password creation with minimum requirements (8 characters, 1 uppercase, 1 lowercase, 1 number, 1 special character).", "The password is accepted, and the user can proceed."], ["4.", "Positive Scenario: Verify entering a valid 6-digit OTP within the 10-minute expiry window.", "The user's email is successfully verified, and they are navigated to the basic profile setup screen."], ["5.", "Positive Scenario: Verify successful submission of basic profile information (DOB, Phone Number).", "The data is accepted, and the user is navigated to the consent and agreements screen."], ["6.", "Positive Scenario: Verify the \"Finish\" button is disabled until the consent checkbox is ticked.", "The button remains disabled. When the user checks the box, the button becomes active."], ["7.", "Positive Scenario: Verify the account is created and the user is logged in after giving consent.", "The user is shown the introductory onboarding tour."], ["8.", "Positive Scenario: Verify the user can skip the onboarding tour.", "The tour is dismissed, and the user is taken to the application's main dashboard."], ["9.", "Negative Scenario: Attempt to register with an already existing email address.", "An error message \"This email address is already registered.\" is displayed."], ["10.", "Negative Scenario: Attempt to submit the registration form with a blank mandatory field (e.g., First Name).", "An inline error message \"This field is required.\" is displayed, and the form is not submitted."], ["11.", "Negative Scenario: Attempt to enter an invalid email format (e.g., \"test@test\").", "A real-time validation error \"Please enter a valid email address.\" is displayed."], ["12.", "Negative Scenario: Attempt to create a password that does not meet the security policy (e.g., less than 8 characters).", "An error message detailing all the required password criteria is displayed."], ["13.", "Negative Scenario: Attempt to enter non-matching passwords in the \"Password\" and \"Confirm Password\" fields.", "An error message \"Passwords do not match.\" is displayed."], ["14.", "Negative Scenario: Enter an incorrect OTP.", "An error message \"Invalid OTP. Please try again.\" is displayed."], ["15.", "Negative Scenario: Enter a valid OTP after the 10-minute expiry window.", "An error message \"OTP has expired. Please request a new one.\" is displayed."], ["16.", "Boundary Case: Verify password creation with exactly 8 characters that meet all other criteria.", "The password is accepted successfully."], ["17.", "Compliance Adherence: Verify that user consent for ToS, Privacy Policy, and HIPAA Notice is recorded with a timestamp in the database.", "The database shows a record of the user's consent with the correct timestamp upon account creation."], ["18.", "Compliance Adherence: Verify that the user's password is not stored in plain text in the database.", "The user's record in the database contains a securely hashed and salted password."], ["19.", "Compliance Adherence: Verify that all data transmitted during the registration process is encrypted.", "Network traffic analysis confirms that all communication between the app and server is over a secure protocol (e.g., TLS 1.2+)."], ["20.", "Compliance Adherence: Verify that a new user creation event is logged in the system's audit trail.", "The audit log contains an entry for the new user registration, including user ID, timestamp, and event type."]], "testcase_id": "0b1d99d6-d8ea-4e0f-b62a-a15940fc27e8", "Testcase Title": "Registration and Onboarding Process: Positive, Negative, Boundary, Compliance", "compliance_ids": ["HIPAA", "ISO 27001", "FDA Guideline"]}], "all_testcases_history": [{"testcases": [["1.", "Positive Scenario: Verify the \"Sign-Up\" button is present and clickable on the main screen.", "The user is navigated to the registration method selection screen."], ["2.", "Positive Scenario: Verify successful registration using the \"Sign up with Email\" option with valid data.", "The user receives an OTP verification email and is redirected to the OTP entry screen."], ["3.", "Positive Scenario: Verify password creation with minimum requirements (8 characters, 1 uppercase, 1 lowercase, 1 number, 1 special character).", "The password is accepted, and the user can proceed."], ["4.", "Positive Scenario: Verify entering a valid 6-digit OTP within the 10-minute expiry window.", "The user's email is successfully verified, and they are navigated to the basic profile setup screen."], ["5.", "Positive Scenario: Verify successful submission of basic profile information (DOB, Phone Number).", "The data is accepted, and the user is navigated to the consent and agreements screen."], ["6.", "Positive Scenario: Verify the \"Finish\" button is disabled until the consent checkbox is ticked.", "The button remains disabled. When the user checks the box, the button becomes active."], ["7.", "Positive Scenario: Verify the account is created and the user is logged in after giving consent.", "The user is shown the introductory onboarding tour."], ["8.", "Positive Scenario: Verify the user can skip the onboarding tour.", "The tour is dismissed, and the user is taken to the application's main dashboard."], ["9.", "Negative Scenario: Attempt to register with an already existing email address.", "An error message \"This email address is already registered.\" is displayed."], ["10.", "Negative Scenario: Attempt to submit the registration form with a blank mandatory field (e.g., First Name).", "An inline error message \"This field is required.\" is displayed, and the form is not submitted."], ["11.", "Negative Scenario: Attempt to enter an invalid email format (e.g., \"test@test\").", "A real-time validation error \"Please enter a valid email address.\" is displayed."], ["12.", "Negative Scenario: Attempt to create a password that does not meet the security policy (e.g., less than 8 characters).", "An error message detailing all the required password criteria is displayed."], ["13.", "Negative Scenario: Attempt to enter non-matching passwords in the \"Password\" and \"Confirm Password\" fields.", "An error message \"Passwords do not match.\" is displayed."], ["14.", "Negative Scenario: Enter an incorrect OTP.", "An error message \"Invalid OTP. Please try again.\" is displayed."], ["15.", "Negative Scenario: Enter a valid OTP after the 10-minute expiry window.", "An error message \"OTP has expired. Please request a new one.\" is displayed."], ["16.", "Boundary Case: Verify password creation with exactly 8 characters that meet all other criteria.", "The password is accepted successfully."], ["17.", "Compliance Adherence: Verify that user consent for ToS, Privacy Policy, and HIPAA Notice is recorded with a timestamp in the database.", "The database shows a record of the user's consent with the correct timestamp upon account creation."], ["18.", "Compliance Adherence: Verify that the user's password is not stored in plain text in the database.", "The user's record in the database contains a securely hashed and salted password."], ["19.", "Compliance Adherence: Verify that all data transmitted during the registration process is encrypted.", "Network traffic analysis confirms that all communication between the app and server is over a secure protocol (e.g., TLS 1.2+)."], ["20.", "Compliance Adherence*: Verify that a new user creation event is logged in the system's audit trail.", "The audit log contains an entry for the new user registration, including user ID, timestamp, and event type."]], "testcase_id": "0b1d99d6-d8ea-4e0f-b62a-a15940fc27e8", "Testcase Title": "Registration and Onboarding Process: Positive, Negative, Boundary, Compliance", "compliance_ids": ["HIPAA", "ISO 27001", "FDA Guideline"]}],
  // };

  // return Promise.resolve(dummyResponse);
}

export async function fetchMessages(userId, sessionId) {
  // Fetches the message history for a specific conversation
  const res = await axios.get(`${API_BASE}/sessions/${sessionId}/messages`, {
    params: { user_id: userId }
  });
  return res.data; // Expected: an array of message objects
}

export async function renameConversation(userId, sessionId, newTitle) {
  const res = await axios.patch(`${API_BASE}/sessions/${sessionId}/title`, 
    { new_title: newTitle },
    { params: { user_id: userId } }
  );
  return res.data;
}

// --- 1. CORRECTED THIS FUNCTION ---
export async function uploadFile(userId, sessionId, file) {
  const formData = new FormData();
  formData.append("file", file);
  formData.append("user_id", userId);
  formData.append("session_id", sessionId);

  // This now points to your new RAG upload endpoint
  const res = await axios.post(`${API_BASE}/api/rag/upload`, formData, {
    headers: { "Content-Type": "multipart/form-data" },
  });
  return res.data;
}

// --- 2. ADDED THIS NEW FUNCTION ---
export async function fetchSessionDocuments(userId, sessionId) {
  const res = await axios.get(`${API_BASE}/api/rag/documents/session/${sessionId}`, {
    params: { user_id: userId }
  });
  return res.data; // Expected: { documents: [], ... }
}

// --- 3. ADDED THIS NEW FUNCTION ---
export async function toggleDocumentActive(userId, documentId, newActiveState) {
  // We send this as form data to match the main.py correction
  const formData = new FormData();
  formData.append("user_id", userId);
  formData.append("is_active", newActiveState);

  const res = await axios.patch(`${API_BASE}/api/rag/documents/${documentId}/toggle`, formData);
  return res.data;
}

// ============================================================================
// JIRA OAUTH API FUNCTIONS
// ============================================================================

export async function checkJiraConnectionStatus(userId) {
  const res = await axios.get(`${API_BASE}/api/jira/status`, {
    params: { user_id: userId }
  });
  return res.data; // { connected: boolean, jira_url?: string, expires_at?: string }
}

export async function initiateJiraOAuth(userId) {
  const res = await axios.get(`${API_BASE}/api/jira/connect`, {
    params: { user_id: userId }
  });
  return res.data; // { authorization_url: string }
}

export async function disconnectJira(userId) {
  const res = await axios.delete(`${API_BASE}/api/jira/disconnect`, {
    params: { user_id: userId }
  });
  return res.data;
}

export async function fetchJiraProjects(userId) {
  const res = await axios.get(`${API_BASE}/api/jira/projects`, {
    params: { user_id: userId }
  });
  return res.data; // { projects: [{key, name}] } or { error: string }
}

export async function fetchJiraRequirements(userId, projectKey) {
  const res = await axios.post(`${API_BASE}/api/jira/fetch-requirements`, {
    user_id: userId,
    project_key: projectKey
  });
  return res.data; // { status: "success", requirements: [...] } or { error: string }
}

export async function createJiraTestCase(userId, projectKey, testCase, requirementKey = null) {
  const res = await axios.post(`${API_BASE}/api/jira/create-test-case`, {
    user_id: userId,
    project_key: projectKey,
    test_case: testCase,
    requirement_key: requirementKey
  });
  return res.data; // { status: "success", jira_key, jira_url } or { error: string }
}

// Update the import function signature
export async function importJiraRequirements(
  userId,
  sessionId,
  requirements,
  overwrite = false
){
  const response = await fetch(`${API_BASE}/api/jira/import-requirements`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      user_id: userId,
      session_id: sessionId,
      requirements,
      overwrite,
    }),
  });
  if (!response.ok) throw new Error('Failed to import requirements');
  return response.json();
}

export async function deleteRequirement(
  userId,
  sessionId,
  requirementId 
){
  console.log("Deleting requirement ID: " + requirementId);
  const response = await fetch(
    `${API_BASE}/api/requirements/${requirementId}?user_id=${userId}&session_id=${sessionId}`,
    {
      method: 'DELETE',
    }
  );
  console.log("delete: " + response);
  if (!response.ok) throw new Error('Failed to delete requirement');
  return response.json();
}

export async function checkDuplicateRequirements(
  userId,
  sessionId,
  requirementIds
){
  const response = await fetch(`${API_BASE}/api/jira/check-duplicate-requirements`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      user_id: userId,
      session_id: sessionId,
      requirement_ids: requirementIds,
    }),
  });
  if (!response.ok) throw new Error('Failed to check duplicates');
  return response.json();
}


export async function getSessionRequirements(userId, sessionId) {
  const res = await axios.get(`${API_BASE}/api/requirements/session/${sessionId}`, {
    params: { user_id: userId }
  });
  return res.data;
}
const deleteAllRequirements = async () => {
  if (!sessionId) return;
  
  if (!confirm("Are you sure you want to delete all imported requirements for this session?")) {
    return;
  }

  try {
    const res = await fetch(`/api/requirements/session/${sessionId}?user_id=${userId}`, {
      method: "DELETE"
    });

    const data = await res.json();

    if (data.status === "success") {
      addToast({ 
        title: "Deleted", 
        description: `${data.deleted} requirements removed`, 
        type: "success" 
      });
      fetchRequirements();
    } else {
      throw new Error("Delete failed");
    }
  } catch (err) {
    addToast({ title: "Error deleting requirements", type: "error" });
    console.error(err);
  }
};
